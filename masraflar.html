<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tabellenkalkulation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/nav.css" />
  <style>
      :root {
        --grad-bg: radial-gradient(circle at 25% 20%, #1f3c73 0%, #15294c 48%, #0d1a30 100%);
        --glass: rgba(18, 30, 52, 0.82);
        --glass-solid: rgba(24, 38, 64, 0.9);
        --border: rgba(255, 255, 255, 0.08);
        --text: #f0f4ff;
        --text-soft: #c3ccdd;
        --accent: #ffd166;
        --accent-alt: #ef476f;
        --accent-blue: #4cc9f0;
        --shadow: 0 18px 38px -12px rgba(5, 10, 25, 0.6);
        --radius: 18px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
        background: #0a1424;
        color: var(--text);
        padding: 0;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      .expenses-shell {
        padding: 32px;
        min-height: calc(100vh - 96px);
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: var(--grad-bg);
        opacity: 0.92;
        z-index: -2;
        animation: bgShift 40s linear infinite;
      }

      @keyframes bgShift {
        0% { transform: scale(1) translate(0, 0); }
        50% { transform: scale(1.12) translate(-3%, 2%); }
        100% { transform: scale(1) translate(0, 0); }
      }

      .container {
        max-width: 1200px;
        margin: 0 auto 48px;
        background: var(--glass);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 28px 32px;
        border: 1px solid var(--border);
        backdrop-filter: blur(22px) saturate(160%);
      }

      h1 {
        margin-bottom: 24px;
        font-size: clamp(1.8rem, 3vw, 2.3rem);
        font-weight: 700;
        letter-spacing: 0.6px;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 12px;
        text-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
      }

      .toolbar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        align-items: center;
      }

      .bottom-actions {
        margin-top: 26px;
        display: flex;
        justify-content: center;
      }

      button {
        padding: 10px 15px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: transform 0.35s ease, box-shadow 0.35s ease, background 0.35s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--text);
        background: var(--glass-solid);
        backdrop-filter: blur(12px);
        box-shadow: 0 10px 26px -10px rgba(0, 0, 0, 0.6);
      }

      button:focus-visible {
        outline: none;
        box-shadow: 0 0 0 3px rgba(255, 209, 102, 0.35), 0 10px 26px -10px rgba(0, 0, 0, 0.6);
      }

      .btn-add {
        background: linear-gradient(120deg, #06d6a0, #40916c);
      }
      .btn-add:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 28px -10px rgba(6, 214, 160, 0.55);
      }
      .btn-delete {
        background: linear-gradient(120deg, #ef476f, #c9184a);
      }
      .btn-delete:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 28px -10px rgba(239, 71, 111, 0.55);
      }
      .btn-save {
        background: linear-gradient(120deg, #4895ef, #4361ee);
      }
      .btn-save:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 28px -10px rgba(72, 149, 239, 0.55);
      }
      .btn-clear {
        background: linear-gradient(120deg, #ffd166, #f77f00);
      }
      .btn-clear:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 28px -10px rgba(247, 127, 0, 0.55);
      }

      .table-wrapper {
        overflow-x: auto;
        margin-bottom: 24px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: rgba(17, 27, 44, 0.45);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
        color: var(--text);
      }

      th,
      td {
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 12px 14px;
        text-align: left;
      }

      th {
        background: linear-gradient(120deg, #4895ef, #4361ee 55%, #8338ec);
        color: #fff;
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 1;
        letter-spacing: 0.4px;
      }

      tbody tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.04);
      }

      tbody tr:hover {
        background: rgba(72, 149, 239, 0.12);
      }

      input[type="text"],
      input[type="date"] {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 10px;
        font-size: 14px;
        background: rgba(11, 19, 34, 0.65);
        color: var(--text);
        transition: border 0.3s ease, box-shadow 0.3s ease;
      }

      input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(255, 209, 102, 0.25);
      }

      .amount-input {
        text-align: right;
      }

      .sum-row {
        background: rgba(72, 149, 239, 0.15) !important;
        font-weight: bold;
        color: var(--accent);
      }

      .sum-row td {
        border-top: 2px solid rgba(72, 149, 239, 0.6);
      }

      .delete-btn {
        background: linear-gradient(120deg, #ef476f, #c9184a);
        color: #fff;
        border: none;
        padding: 8px 10px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      .delete-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px -8px rgba(239, 71, 111, 0.6);
      }

      .info-box {
        background: rgba(72, 149, 239, 0.18);
        padding: 18px 22px;
        border-radius: var(--radius);
        margin-bottom: 26px;
        border-left: 4px solid rgba(255, 209, 102, 0.8);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      }

      .info-box h3 {
        margin-bottom: 12px;
        color: var(--text);
        font-size: 1rem;
        letter-spacing: 0.4px;
      }

      .total-display {
        font-size: 26px;
        color: var(--accent);
        font-weight: 700;
        text-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);
      }

      @media screen and (max-width: 768px) {
        .expenses-shell {
          padding: 18px;
          min-height: auto;
        }

        .container {
          padding: 18px;
          box-shadow: 0 12px 28px -14px rgba(5, 10, 25, 0.75);
          border-radius: 16px;
        }

        h1 {
          font-size: 1.6rem;
        }

        .toolbar {
          gap: 10px;
          justify-content: center;
        }

        button {
          padding: 9px 14px;
          font-size: 13px;
          border-radius: 12px;
        }

        .bottom-actions {
          margin-top: 24px;
        }

        .bottom-actions .btn-add {
          width: 100%;
          justify-content: center;
          padding: 12px 18px;
        }

        .table-wrapper {
          overflow: visible;
          border: none;
          background: transparent;
          box-shadow: none;
        }

        table {
          min-width: 0;
          width: 100%;
        }

        table,
        tbody,
        tfoot,
        tr {
          display: block;
          width: 100%;
        }

        thead {
          display: none;
        }

        tbody tr {
          display: flex;
          flex-direction: column;
          gap: 12px;
          border: 1px solid rgba(255, 255, 255, 0.14);
          border-radius: 14px;
          padding: 18px 16px;
          margin-bottom: 18px;
          background: rgba(17, 27, 44, 0.82);
          box-shadow: 0 14px 26px -16px rgba(0, 0, 0, 0.8);
        }

        tbody tr:nth-child(even) {
          background: rgba(17, 27, 44, 0.82);
        }

        td {
          border: none;
          padding: 0;
          display: flex;
          flex-direction: column;
          align-items: stretch;
          text-align: left;
          color: var(--text);
        }

        td:before {
          content: attr(data-label);
          font-weight: 600;
          font-size: 13px;
          margin-bottom: 6px;
          color: var(--text-soft);
        }

        input[type="text"],
        input[type="date"] {
          width: 100%;
          padding: 12px 14px;
          font-size: 15px;
          background: rgba(10, 16, 28, 0.7);
        }

        .amount-input {
          text-align: right;
        }

        .delete-btn {
          align-self: flex-start;
          padding: 9px 16px;
          font-size: 13px;
          width: auto;
        }

        .sum-row {
          display: grid;
          gap: 6px;
          padding: 16px;
          background: rgba(72, 149, 239, 0.18);
          border-radius: 14px;
          margin-top: 18px;
        }

        .sum-row td {
          border: none;
          padding: 0;
          display: block;
          text-align: left;
          color: var(--text);
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <header class="tt-site-header">
      <nav class="nav" aria-label="∆èsas naviqasiya">
        <a class="brand" href="index.html" aria-label="Turkaz Turan ana s…ôhif…ô">
          <img class="logo" src="images/logo.svg" alt="logo" width="36" height="36" />
          <span class="brand-text">
            <span class="title">Turkaz Turan</span>
          </span>
        </a>
        <button
          id="menuToggle"
          class="menu-toggle"
          type="button"
          aria-expanded="false"
          aria-controls="primary-menu"
        >
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <defs>
              <linearGradient
                id="navToggleGradient"
                x1="4"
                y1="7"
                x2="20"
                y2="17"
                gradientUnits="userSpaceOnUse"
              >
                <stop offset="0%" stop-color="#22d3ee" />
                <stop offset="50%" stop-color="#7c5cff" />
                <stop offset="100%" stop-color="#6ee7ff" />
              </linearGradient>
            </defs>
            <path
              d="M4 7h16M4 12h16M4 17h16"
              stroke="url(#navToggleGradient)"
              stroke-width="1.8"
              stroke-linecap="round"
            />
          </svg>
          <span class="sr-only">Men√ºn√º a√ß</span>
        </button>
        <div class="menu" id="primary-menu">
          <a href="namaz.html">Namaz</a>
          <a href="quran/quran.html">Quran</a>
          <a href="masraflar.html">X…ôrcl…ôr</a>
          <a href="currency.html">Valyuta</a>
        </div>
        <div class="controls">
          <button
            id="siteThemeToggle"
            class="toggle"
            type="button"
            aria-pressed="false"
            title="Tema d…ôyi≈ü"
          >
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              aria-hidden="true"
            >
              <defs>
                <linearGradient
                  id="themeToggleGradient"
                  x1="6"
                  y1="6"
                  x2="20"
                  y2="20"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop offset="0%" stop-color="#6ee7ff" />
                  <stop offset="50%" stop-color="#7c5cff" />
                  <stop offset="100%" stop-color="#22d3ee" />
                </linearGradient>
              </defs>
              <path
                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"
                stroke="url(#themeToggleGradient)"
                stroke-width="1.6"
              />
            </svg>
            <span>Tema</span>
          </button>
        </div>
      </nav>
    </header>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <main class="expenses-shell">
      <div class="container">
      <h1>üìä Monatliche Ausgaben</h1>

      <div class="info-box">
        <h3>
          Gesamtsumme: <span class="total-display" id="totalSum">0.00 ‚Ç¨</span>
        </h3>
      </div>

      <div class="toolbar">
        <button class="btn-save" onclick="saveData(event)">
          <i class="fa-solid fa-floppy-disk"></i> Speichern
        </button>
        <button class="btn-save" onclick="loadData()">
          <i class="fa-solid fa-folder-open"></i> Laden
        </button>
        <button
          class="btn-save"
          onclick="document.getElementById('fileInput').click()"
        >
          <i class="fa-solid fa-file-import"></i> Excel importieren
        </button>
        <button class="btn-save" onclick="exportToExcel()">
          <i class="fa-solid fa-file-export"></i> Excel exportieren
        </button>
        <button class="btn-clear" onclick="clearAll()">
          <i class="fa-solid fa-trash-can"></i> Alles l√∂schen
        </button>
        <input
          type="file"
          id="fileInput"
          accept=".xlsx,.xls"
          style="display: none"
          onchange="importExcel(event)"
        />
      </div>      <div class="table-wrapper">
        <table id="dataTable">
          <thead>
            <tr>
              <th style="width: 150px">Datum der Buchung</th>
              <th style="width: 300px">Beschreibung der Geldinstitut</th>
              <th style="width: 150px">Betrag (‚Ç¨)</th>
              <th style="width: 100px">Aktion</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Zeilen werden hier eingef√ºgt -->
          </tbody>
          <tfoot>
            <tr class="sum-row">
              <td colspan="2" style="text-align: right">
                <strong>Gesamt:</strong>
              </td>
              <td id="sumCell"><strong>0.00 ‚Ç¨</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div class="bottom-actions">
        <button class="btn-add" onclick="addRow()">
          <i class="fa-solid fa-plus"></i> Zeile hinzuf√ºgen
        </button>
      </div>
      </div>
    </main>

    <script src="scripts/nav.js" defer></script>
    <script>
              let rowCounter = 0;

              // Hilfsfunktionen f√ºr Zahlen
              function parseNormalizedNumber(value) {
                  if (typeof value === 'number') return value;
                  const s = String(value || '').trim().replace(/\s/g, '').replace(',', '.');
                  const num = parseFloat(s);
                  return isNaN(num) ? 0 : num;
              }

              function formatToTwoDecimals(value) {
                  const num = parseNormalizedNumber(value);
                  return Number.isFinite(num) ? num.toFixed(2) : '';
              }

              function formatAmountInput(inputEl) {
                  if (!inputEl) return;
                  if (inputEl.value === '') return;
                  inputEl.value = formatToTwoDecimals(inputEl.value);
              }

              // Daten beim Start laden
              window.addEventListener('load', () => {
                  loadData();
                  if (document.querySelectorAll('#tableBody tr').length === 0) {
                      addRow();
                  } else {
                      formatAllAmounts();
                      updateSum();
                  }
              });

              function buildAmountCell(value = '') {
                  const formatted = value === '' ? '' : formatToTwoDecimals(value);
                  return `
                      <input
                          type="text"
                          inputmode="decimal"
                          class="amount-input"
                          placeholder="0.00"
                          value="${formatted}"
                          oninput="updateSum()"
                          onblur="formatAmountInput(this); updateSum(); saveData()"
                      >
                  `;
              }

              function addRow() {
                  const tbody = document.getElementById('tableBody');
                  const row = document.createElement('tr');
                  row.id = 'row-' + rowCounter;

                  row.innerHTML = `
                      <td data-label="Datum"><input type="date" class="date-input" onchange="saveData()"></td>
                      <td data-label="Beschreibung"><input type="text" class="desc-input" placeholder="Beschreibung..." onchange="saveData()"></td>
                      <td data-label="Betrag (‚Ç¨)">${buildAmountCell('')}</td>
                      <td data-label="Aktion"><button class="delete-btn" onclick="deleteRow('row-${rowCounter}')">‚ùå L√∂schen</button></td>
                  `;

                  tbody.appendChild(row);
                  rowCounter++;
                  updateSum();
              }

              function deleteRow(rowId) {
                  const row = document.getElementById(rowId);
                  if (row) {
                      row.remove();
                      updateSum();
                      saveData();
                  }
              }

              function updateSum() {
                  const amounts = document.querySelectorAll('.amount-input');
                  let sum = 0;

                  amounts.forEach(input => {
                      const value = parseNormalizedNumber(input.value);
                      sum += value;
                  });

                  document.getElementById('sumCell').innerHTML = `<strong>${sum.toFixed(2)} ‚Ç¨</strong>`;
                  document.getElementById('totalSum').textContent = sum.toFixed(2) + ' ‚Ç¨';
              }

        function saveData(evt) {
                  const rows = document.querySelectorAll('#tableBody tr');
                  const data = [];

                  rows.forEach(row => {
                      const date = row.querySelector('.date-input').value;
                      const desc = row.querySelector('.desc-input').value;
                      const amountEl = row.querySelector('.amount-input');
                      const amount = amountEl.value ? formatToTwoDecimals(amountEl.value) : '';

                      if (date || desc || amount) {
                          data.push({ date, desc, amount });
                      }
                  });

                  localStorage.setItem('tableData', JSON.stringify(data));

          // Tempor√§re Best√§tigung nur wenn ein Speichern-Button geklickt wurde
          const rawTarget = evt?.target instanceof HTMLElement ? evt.target : null;
          const saveBtn = rawTarget?.closest('button');
          if (saveBtn && typeof saveBtn.textContent === 'string' && saveBtn.textContent.includes('Speichern')) {
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '‚úÖ Gespeichert!';
            const originalBackground = saveBtn.style.background;
            const originalBoxShadow = saveBtn.style.boxShadow;
            saveBtn.style.background = 'linear-gradient(120deg, #06d6a0, #40916c)';
            saveBtn.style.boxShadow = '0 12px 28px -10px rgba(6, 214, 160, 0.6)';
            setTimeout(() => {
              saveBtn.textContent = originalText;
              saveBtn.style.background = originalBackground || 'linear-gradient(120deg, #4895ef, #4361ee)';
              saveBtn.style.boxShadow = originalBoxShadow || '0 12px 28px -10px rgba(72, 149, 239, 0.55)';
            }, 1500);
                  }
              }

              function loadData() {
                  const savedData = localStorage.getItem('tableData');
                  if (savedData) {
                      const data = JSON.parse(savedData);
                      const tbody = document.getElementById('tableBody');
                      tbody.innerHTML = '';
                      rowCounter = 0;

                      data.forEach(item => {
                          const row = document.createElement('tr');
                          row.id = 'row-' + rowCounter;

                          row.innerHTML = `
                              <td data-label="Datum"><input type="date" class="date-input" value="${item.date || ''}" onchange="saveData()"></td>
                              <td data-label="Beschreibung"><input type="text" class="desc-input" value="${item.desc || ''}" onchange="saveData()"></td>
                              <td data-label="Betrag (‚Ç¨)">${buildAmountCell(item.amount || '')}</td>
                              <td data-label="Aktion"><button class="delete-btn" onclick="deleteRow('row-${rowCounter}')">‚ùå L√∂schen</button></td>
                          `;

                          tbody.appendChild(row);
                          rowCounter++;
                      });

                      formatAllAmounts();
                      updateSum();
                  }
              }

              function formatAllAmounts() {
                  document.querySelectorAll('.amount-input').forEach(input => {
                      if (input.value !== '') {
                          input.value = formatToTwoDecimals(input.value);
                      }
                  });
              }

              function clearAll() {
                  if (confirm('M√∂chten Sie wirklich alle Daten l√∂schen?')) {
                      document.getElementById('tableBody').innerHTML = '';
                      localStorage.removeItem('tableData');
                      rowCounter = 0;
                      updateSum();
                      addRow();
                  }
              }

              // Autosave bei √Ñnderungen
              document.addEventListener('input', (e) => {
                  if (e.target.classList.contains('date-input') ||
                      e.target.classList.contains('desc-input') ||
                      e.target.classList.contains('amount-input')) {
                      setTimeout(saveData, 500);
                  }
              });

              function importExcel(event) {
                  const file = event.target.files[0];
                  if (!file) return;

                  const reader = new FileReader();
                  reader.onload = function(e) {
                      try {
                          const data = new Uint8Array(e.target.result);
                          const workbook = XLSX.read(data, { type: 'array' });
                          const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                          const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                          // Tabelle leeren
                          document.getElementById('tableBody').innerHTML = '';
                          rowCounter = 0;

                          // Daten importieren (erste Zeile √ºberspringen wenn Header)
                          const startRow = jsonData[0] && typeof jsonData[0][0] === 'string' ? 1 : 0;

                          for (let i = startRow; i < jsonData.length; i++) {
                              const rowData = jsonData[i];
                              if (!rowData || rowData.length === 0) continue;

                              const row = document.createElement('tr');
                              row.id = 'row-' + rowCounter;

                              let dateValue = '';
                              let descValue = rowData[1] ?? '';
                              let amountValue = '';

                              // Datum konvertieren
                              if (rowData[0]) {
                                  if (typeof rowData[0] === 'string' && rowData[0].includes('T')) {
                                      const date = new Date(rowData[0]);
                                      dateValue = date.toISOString().split('T')[0];
                                  } else if (typeof rowData[0] === 'number') {
                                      // Excel Datum Konvertierung
                                      const date = new Date((rowData[0] - 25569) * 86400 * 1000);
                                      dateValue = date.toISOString().split('T')[0];
                                  } else {
                                      dateValue = rowData[0];
                                  }
                              }

                              // Betrag
                              if (rowData[2] !== undefined && rowData[2] !== null && rowData[2] !== '') {
                                  amountValue = formatToTwoDecimals(rowData[2]);
                              }

                              row.innerHTML = `
                                  <td data-label="Datum"><input type="date" class="date-input" value="${dateValue}" onchange="saveData()"></td>
                                  <td data-label="Beschreibung"><input type="text" class="desc-input" value="${descValue}" onchange="saveData()"></td>
                                  <td data-label="Betrag (‚Ç¨)">${buildAmountCell(amountValue)}</td>
                                  <td data-label="Aktion"><button class="delete-btn" onclick="deleteRow('row-${rowCounter}')">‚ùå L√∂schen</button></td>
                              `;

                              document.getElementById('tableBody').appendChild(row);
                              rowCounter++;
                          }

                          updateSum();
                          saveData();
                          alert('Excel-Datei erfolgreich importiert!');
                      } catch (error) {
                          alert('Fehler beim Importieren: ' + error.message);
                      }
                  };
                  reader.readAsArrayBuffer(file);
                  event.target.value = ''; // Reset file input
              }

              function exportToExcel() {
          const rows = document.querySelectorAll('#tableBody tr');
          const data = [['Datum der Buchung', 'Beschreibung der Geldinstitut', 'Betrag']];

          // Daten sammeln
          rows.forEach(row => {
              const date = row.querySelector('.date-input').value;
              const desc = row.querySelector('.desc-input').value;
              const amountStr = row.querySelector('.amount-input').value;
              const amountNum = parseFloat(amountStr.toString().replace(',', '.')) || 0;

              if (date || desc || amountStr) {
                  data.push([date, desc, amountNum]);
              }
          });

          // Anzahl Datens√§tze (ohne Header)
          const dataRowsCount = data.length - 1; // ab Zeile 2 in Excel

          // Summe-Zeile hinzuf√ºgen (Formel oder 0, wenn keine Daten)
          const sumCell = dataRowsCount > 0
              ? { t: 'n', f: `SUM(C2:C${1 + dataRowsCount})`, z: '0.00' }
              : 0;
          data.push(['', 'Gesamt', sumCell]);

          // Sheet erstellen
          const ws = XLSX.utils.aoa_to_sheet(data);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Daten");

          // Zahlenformat f√ºr Spalte C (nur Datenzeilen) setzen
          // Excel-Zeilen: Daten sind 2..(1 + dataRowsCount)
          for (let excelRow = 2; excelRow <= 1 + dataRowsCount; excelRow++) {
              const ref = XLSX.utils.encode_cell({ r: excelRow - 1, c: 2 }); // 0-basiert
              const cell = ws[ref];
              if (cell && typeof cell.v === 'number') {
                  cell.z = '0.00';
              }
          }

          // Falls Summe-Zelle numerisch 0 (kein Datenbestand), auch formatieren
          const sumRowExcel = 1 + dataRowsCount + 1; // direkt unter den Daten
          const sumRef = XLSX.utils.encode_cell({ r: sumRowExcel - 1, c: 2 });
          if (ws[sumRef] && typeof ws[sumRef].v === 'number') {
              ws[sumRef].z = '0.00';
          }

          XLSX.writeFile(wb, "ausgaben_export.xlsx");
      }
    </script>
  </body>
</html>
